@model IEnumerable<UrlShortener.Models.ShortUrl>

@{
    ViewData["Title"] = "All Shortened Links";
}

<style>
    .center-wrapper {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 30px;
    }

    .card-custom {
        background: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        color: #000;
        min-width: 900px;
    }
</style>

<div class="center-wrapper">
    <div class="card-custom">
        <h2 class="mb-4">All Shortened Links</h2>
        <div class="table-responsive">
            <table class="table table-bordered table-striped table-hover align-middle mb-0">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 270px;">Short URL</th>
                        <th>Original URL</th>
                        <th style="width: 100px;">Created At</th>
                        <th style="width: 280px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var link in Model)
                    {
                        var shortUrl = $"{Context.Request.Scheme}://{Context.Request.Host}/{link.ShortCode}";
                        <tr>
                            <td>
                                <input type="text" class="form-control" id="shortUrl-@link.Id" value="@shortUrl" />
                            </td>
                            <td>
                                <a href="@link.OriginalUrl" target="_blank">@link.OriginalUrl</a>
                            </td>
                            <td>@link.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                            <td>
                                <a href="@shortUrl" target="_blank" class="btn btn-primary btn-sm me-2">Visit</a>
                                <button class="btn btn-success btn-sm me-2" onclick="copyToClipboard('@shortUrl')">Copy</button>
                                <button class="btn btn-warning btn-sm me-2" onclick="updateShortUrl(@link.Id)">Update</button>
                                <a href="@Url.Action("Delete", "LinksList", new { id = link.Id })"
                                   class="btn btn-danger btn-sm"
                                   onclick="return confirm('Are you sure you want to delete this link?');">
                                    Delete
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert("Copied to clipboard!");
            });
        }

        function updateShortUrl(id) {
            var newUrl = document.getElementById("shortUrl-" + id).value;

            fetch('/LinksList/UpdateShortCode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `id=${id}&fullUrl=${encodeURIComponent(newUrl)}`
            }).then(response => {
                if (response.ok) {
                    alert('Short URL updated successfully!');
                    location.reload();
                } else if (response.status === 409) {
                    alert('Short code already exists!');
                } else {
                    alert('Error updating Short URL.');
                }
            });
        }
    </script>
}
